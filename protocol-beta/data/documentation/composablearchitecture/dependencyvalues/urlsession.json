{"primaryContentSections":[{"kind":"declarations","declarations":[{"tokens":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"urlSession"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"URLSession","preciseIdentifier":"c:objc(cs)NSURLSession"},{"kind":"text","text":" { "},{"kind":"keyword","text":"get"},{"kind":"text","text":" "},{"kind":"keyword","text":"set"},{"kind":"text","text":" }"}],"languages":["swift"],"platforms":["macOS"]}]},{"kind":"content","content":[{"anchor":"discussion","level":2,"type":"heading","text":"Discussion"},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default, the session returned from "},{"type":"codeVoice","code":"URLSession.shared"},{"type":"text","text":" is supplied. When used from a"},{"type":"text","text":" "},{"type":"codeVoice","code":"TestStore"},{"type":"text","text":", access will call to "},{"type":"codeVoice","code":"XCTFail"},{"type":"text","text":" when invoked, unless explicitly overridden:"}]},{"type":"codeListing","syntax":"swift","code":["let store = TestStore(","  initialState: MyFeature.State()","  reducer: MyFeature()",")","","let mockConfiguration = URLSessionConfiguration.ephemeral","mockConfiguration.protocolClasses = [MyMockURLProtocol.self]","store.dependencies.urlSession = URLSession(configuration: mockConfiguration)"]},{"anchor":"API-client-dependencies","level":3,"type":"heading","text":"API client dependencies"},{"type":"paragraph","inlineContent":[{"type":"text","text":"While it is possible to use this dependency value from more complex dependencies, like API"},{"type":"text","text":" "},{"type":"text","text":"clients, we generally advise against "},{"type":"emphasis","inlineContent":[{"type":"text","text":"designing"}]},{"type":"text","text":" a dependency around a URL session. Mocking a"},{"type":"text","text":" "},{"type":"text","text":"URL sessionâ€™s responses is a complex process that requires a lot of work that can be avoided."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"For example, instead of defining your dependency in a way that holds directly onto a URL"},{"type":"text","text":" "},{"type":"text","text":"session in order to invoke it from a concrete implementation:"}]},{"type":"codeListing","syntax":"swift","code":["struct APIClient {","  let urlSession: URLSession","","  func fetchProfile() async throws -> Profile {","    \/\/ Use URL session to make request","  }","","  func fetchTimeline() async throws -> Timeline { \/* ... *\/ }","  \/\/ ...","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Define your dependency as a lightweight "},{"type":"emphasis","inlineContent":[{"type":"text","text":"interface"}]},{"type":"text","text":" that holds onto endpoints that can be"},{"type":"text","text":" "},{"type":"text","text":"individually overridden in a lightweight fashion:"}]},{"type":"codeListing","syntax":"swift","code":["struct APIClient {","  var fetchProfile: () async throws -> Profile","  var fetchTimeline: () async throws -> Timeline","  \/\/ ...","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Then, you can extend this type with a live implementation that uses a URL session under the"},{"type":"text","text":" "},{"type":"text","text":"hood:"}]},{"type":"codeListing","syntax":"swift","code":["extension APIClient {","  static func live(urlSession: URLSession) -> Self {","    Self(","      fetchProfile: {","        \/\/ Use URL session to make request","      }","      fetchTimeline: { \/* ... *\/ },","      \/\/ ...","    )","  }","}"]}]}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/composablearchitecture\/dependencyvalues\/urlsession"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/co.pointfree.ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/urlSession","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"The URL session that reducers should use to make URL requests."}],"kind":"symbol","metadata":{"role":"symbol","title":"urlSession","roleHeading":"Instance Property","fragments":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"urlSession"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"URLSession","preciseIdentifier":"c:objc(cs)NSURLSession"}],"symbolKind":"property","externalID":"s:12Dependencies16DependencyValuesV10urlSessionSo12NSURLSessionCvp","extendedModule":"Dependencies","modules":[{"name":"ComposableArchitecture"}]},"hierarchy":{"paths":[["doc:\/\/co.pointfree.ComposableArchitecture\/documentation\/Dependencies","doc:\/\/co.pointfree.ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues"]]},"references":{"doc://co.pointfree.ComposableArchitecture/documentation/ComposableArchitecture/DependencyValues":{"role":"symbol","title":"DependencyValues","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"DependencyValues"}],"abstract":[{"type":"text","text":"A collection of dependencies propagated through a reducer hierarchy."}],"identifier":"doc:\/\/co.pointfree.ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"DependencyValues"}],"url":"\/documentation\/composablearchitecture\/dependencyvalues"},"doc://co.pointfree.ComposableArchitecture/documentation/Dependencies":{"role":"collection","title":"Dependencies","abstract":[],"identifier":"doc:\/\/co.pointfree.ComposableArchitecture\/documentation\/Dependencies","kind":"symbol","type":"topic","url":"\/documentation\/dependencies"},"doc://co.pointfree.ComposableArchitecture/documentation/ComposableArchitecture/DependencyValues/urlSession":{"role":"symbol","title":"urlSession","fragments":[{"kind":"keyword","text":"var"},{"kind":"text","text":" "},{"kind":"identifier","text":"urlSession"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"URLSession","preciseIdentifier":"c:objc(cs)NSURLSession"}],"abstract":[{"type":"text","text":"The URL session that reducers should use to make URL requests."}],"identifier":"doc:\/\/co.pointfree.ComposableArchitecture\/documentation\/ComposableArchitecture\/DependencyValues\/urlSession","kind":"symbol","type":"topic","url":"\/documentation\/composablearchitecture\/dependencyvalues\/urlsession"}}}